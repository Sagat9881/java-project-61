.DEFAULT_GOAL := build-run

SRC_DIR := src/main/java
BIN_DIR := build/classes
JAR_DIR := build/libs
JAR_FILE := $(JAR_DIR)/app.jar
MAIN_CLASS := hexlet.code.Main
MAIN_FILE := $(SRC_DIR)/$(subst .,/,$(MAIN_CLASS)).java
SOURCE_VERSION := 21

# –ù–∞–π—Ç–∏ –≤—Å–µ .java —Ñ–∞–π–ª—ã
JAVA_FILES := $(shell find $(SRC_DIR) -name "*.java")

# –¶–µ–ª—å: —Å–±–æ—Ä–∫–∞ + –∑–∞–ø—É—Å–∫
build-run: build run

# –û—á–∏—Å—Ç–∫–∞
clean:
	rm -rf $(BIN_DIR) $(JAR_DIR)
	@echo "üóëÔ∏è  Cleaned build directories"

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è
build: clean
	mkdir -p $(BIN_DIR)
	javac --source=$(SOURCE_VERSION) -d $(BIN_DIR) $(JAVA_FILES)
	@echo "‚úÖ Compiled to $(BIN_DIR)"

# –°–±–æ—Ä–∫–∞ JAR
jar: build
	mkdir -p $(JAR_DIR)
	jar --create \
	    --file=$(JAR_FILE) \
	    --main-class=$(MAIN_CLASS) \
	    -C $(BIN_DIR) .
	@echo "üì¶ JAR created: $(JAR_FILE)"

# –ó–∞–ø—É—Å–∫ –∏–∑ –∫–ª–∞—Å—Å–æ–≤
run: build
	java --source=$(SOURCE_VERSION) -cp $(BIN_DIR) $(MAIN_CLASS)

# –ó–∞–ø—É—Å–∫ –∏–∑ JAR (–¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤)
run-dist: jar
	java -jar $(JAR_FILE)

# –¢–µ—Å—Ç—ã (–∑–∞–≥–ª—É—à–∫–∞)
test:
	@echo "‚ÑπÔ∏è –¢–µ—Å—Ç—ã: —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å JUnit –≤—Ä—É—á–Ω—É—é"

# –õ–∏–Ω—Ç–µ—Ä (–∑–∞–≥–ª—É—à–∫–∞)
lint:
	@echo "‚ÑπÔ∏è –õ–∏–Ω—Ç–µ—Ä: –¥–æ–±–∞–≤—å—Ç–µ google-java-format –∏–ª–∏ checkstyle –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏"

# –û—Ç—á—ë—Ç—ã (–∑–∞–≥–ª—É—à–∫–∞)
report:
	@echo "‚ÑπÔ∏è –û—Ç—á—ë—Ç—ã: —Ç—Ä–µ–±—É—é—Ç JaCoCo ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä—É—á–Ω—É—é"

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ‚Äî –æ—Ç–∫–ª—é—á–µ–Ω–æ
update-deps:
	@echo "‚ÑπÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é –±–µ–∑ Gradle"

.PHONY: clean build run test lint report update-deps build-run jar run-dist